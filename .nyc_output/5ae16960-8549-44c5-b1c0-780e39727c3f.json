{"E:\\GitHub-Demos\\node-csv-excel\\src\\helpers\\invoice.helper.ts":{"path":"E:\\GitHub-Demos\\node-csv-excel\\src\\helpers\\invoice.helper.ts","statementMap":{"0":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"1":{"start":{"line":3,"column":4},"end":{"line":3,"column":62}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":62}},"3":{"start":{"line":6,"column":0},"end":{"line":6,"column":47}},"4":{"start":{"line":7,"column":14},"end":{"line":7,"column":45}},"5":{"start":{"line":8,"column":12},"end":{"line":8,"column":54}},"6":{"start":{"line":12,"column":22},"end":{"line":21,"column":6}},"7":{"start":{"line":23,"column":27},"end":{"line":23,"column":96}},"8":{"start":{"line":25,"column":25},"end":{"line":25,"column":190}},"9":{"start":{"line":25,"column":164},"end":{"line":25,"column":178}},"10":{"start":{"line":27,"column":21},"end":{"line":31,"column":5}},"11":{"start":{"line":32,"column":4},"end":{"line":32,"column":20}},"12":{"start":{"line":34,"column":38},"end":{"line":92,"column":1}},"13":{"start":{"line":36,"column":29},"end":{"line":36,"column":34}},"14":{"start":{"line":37,"column":34},"end":{"line":37,"column":36}},"15":{"start":{"line":38,"column":30},"end":{"line":38,"column":32}},"16":{"start":{"line":39,"column":4},"end":{"line":86,"column":7}},"17":{"start":{"line":40,"column":33},"end":{"line":40,"column":38}},"18":{"start":{"line":41,"column":8},"end":{"line":45,"column":9}},"19":{"start":{"line":42,"column":12},"end":{"line":42,"column":68}},"20":{"start":{"line":43,"column":12},"end":{"line":43,"column":38}},"21":{"start":{"line":44,"column":12},"end":{"line":44,"column":39}},"22":{"start":{"line":47,"column":8},"end":{"line":49,"column":9}},"23":{"start":{"line":48,"column":12},"end":{"line":48,"column":126}},"24":{"start":{"line":48,"column":75},"end":{"line":48,"column":124}},"25":{"start":{"line":51,"column":30},"end":{"line":51,"column":135}},"26":{"start":{"line":52,"column":33},"end":{"line":52,"column":51}},"27":{"start":{"line":54,"column":31},"end":{"line":54,"column":85}},"28":{"start":{"line":56,"column":30},"end":{"line":56,"column":32}},"29":{"start":{"line":57,"column":8},"end":{"line":58,"column":61}},"30":{"start":{"line":58,"column":12},"end":{"line":58,"column":61}},"31":{"start":{"line":59,"column":8},"end":{"line":60,"column":53}},"32":{"start":{"line":60,"column":12},"end":{"line":60,"column":53}},"33":{"start":{"line":61,"column":28},"end":{"line":67,"column":9}},"34":{"start":{"line":69,"column":8},"end":{"line":83,"column":9}},"35":{"start":{"line":70,"column":12},"end":{"line":77,"column":15}},"36":{"start":{"line":80,"column":39},"end":{"line":80,"column":86}},"37":{"start":{"line":81,"column":12},"end":{"line":81,"column":56}},"38":{"start":{"line":82,"column":12},"end":{"line":82,"column":55}},"39":{"start":{"line":85,"column":8},"end":{"line":85,"column":114}},"40":{"start":{"line":88,"column":4},"end":{"line":91,"column":6}},"41":{"start":{"line":93,"column":0},"end":{"line":93,"column":70}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":2,"column":56},"end":{"line":2,"column":57}},"loc":{"start":{"line":2,"column":71},"end":{"line":4,"column":1}},"line":2},"1":{"name":"validateInvoiceItem","decl":{"start":{"line":9,"column":9},"end":{"line":9,"column":28}},"loc":{"start":{"line":9,"column":42},"end":{"line":33,"column":1}},"line":9},"2":{"name":"(anonymous_2)","decl":{"start":{"line":25,"column":152},"end":{"line":25,"column":153}},"loc":{"start":{"line":25,"column":164},"end":{"line":25,"column":178}},"line":25},"3":{"name":"(anonymous_3)","decl":{"start":{"line":34,"column":38},"end":{"line":34,"column":39}},"loc":{"start":{"line":34,"column":56},"end":{"line":92,"column":1}},"line":34},"4":{"name":"(anonymous_4)","decl":{"start":{"line":39,"column":25},"end":{"line":39,"column":26}},"loc":{"start":{"line":39,"column":39},"end":{"line":86,"column":5}},"line":39},"5":{"name":"(anonymous_5)","decl":{"start":{"line":48,"column":60},"end":{"line":48,"column":61}},"loc":{"start":{"line":48,"column":75},"end":{"line":48,"column":124}},"line":48}},"branchMap":{"0":{"loc":{"start":{"line":2,"column":22},"end":{"line":4,"column":1}},"type":"binary-expr","locations":[{"start":{"line":2,"column":23},"end":{"line":2,"column":27}},{"start":{"line":2,"column":31},"end":{"line":2,"column":51}},{"start":{"line":2,"column":56},"end":{"line":4,"column":1}}],"line":2},"1":{"loc":{"start":{"line":3,"column":11},"end":{"line":3,"column":61}},"type":"cond-expr","locations":[{"start":{"line":3,"column":37},"end":{"line":3,"column":40}},{"start":{"line":3,"column":43},"end":{"line":3,"column":61}}],"line":3},"2":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":15}},{"start":{"line":3,"column":19},"end":{"line":3,"column":33}}],"line":3},"3":{"loc":{"start":{"line":25,"column":25},"end":{"line":25,"column":190}},"type":"cond-expr","locations":[{"start":{"line":25,"column":136},"end":{"line":25,"column":142}},{"start":{"line":25,"column":145},"end":{"line":25,"column":190}}],"line":25},"4":{"loc":{"start":{"line":25,"column":25},"end":{"line":25,"column":133}},"type":"binary-expr","locations":[{"start":{"line":25,"column":25},"end":{"line":25,"column":116}},{"start":{"line":25,"column":120},"end":{"line":25,"column":133}}],"line":25},"5":{"loc":{"start":{"line":25,"column":31},"end":{"line":25,"column":106}},"type":"cond-expr","locations":[{"start":{"line":25,"column":87},"end":{"line":25,"column":93}},{"start":{"line":25,"column":96},"end":{"line":25,"column":106}}],"line":25},"6":{"loc":{"start":{"line":25,"column":31},"end":{"line":25,"column":84}},"type":"binary-expr","locations":[{"start":{"line":25,"column":31},"end":{"line":25,"column":67}},{"start":{"line":25,"column":71},"end":{"line":25,"column":84}}],"line":25},"7":{"loc":{"start":{"line":28,"column":16},"end":{"line":28,"column":50}},"type":"cond-expr","locations":[{"start":{"line":28,"column":31},"end":{"line":28,"column":38}},{"start":{"line":28,"column":41},"end":{"line":28,"column":50}}],"line":28},"8":{"loc":{"start":{"line":41,"column":8},"end":{"line":45,"column":9}},"type":"if","locations":[{"start":{"line":41,"column":8},"end":{"line":45,"column":9}},{"start":{},"end":{}}],"line":41},"9":{"loc":{"start":{"line":47,"column":8},"end":{"line":49,"column":9}},"type":"if","locations":[{"start":{"line":47,"column":8},"end":{"line":49,"column":9}},{"start":{},"end":{}}],"line":47},"10":{"loc":{"start":{"line":54,"column":31},"end":{"line":54,"column":85}},"type":"binary-expr","locations":[{"start":{"line":54,"column":31},"end":{"line":54,"column":49}},{"start":{"line":54,"column":53},"end":{"line":54,"column":85}}],"line":54},"11":{"loc":{"start":{"line":57,"column":8},"end":{"line":58,"column":61}},"type":"if","locations":[{"start":{"line":57,"column":8},"end":{"line":58,"column":61}},{"start":{},"end":{}}],"line":57},"12":{"loc":{"start":{"line":59,"column":8},"end":{"line":60,"column":53}},"type":"if","locations":[{"start":{"line":59,"column":8},"end":{"line":60,"column":53}},{"start":{},"end":{}}],"line":59},"13":{"loc":{"start":{"line":69,"column":8},"end":{"line":83,"column":9}},"type":"if","locations":[{"start":{"line":69,"column":8},"end":{"line":83,"column":9}},{"start":{"line":79,"column":13},"end":{"line":83,"column":9}}],"line":69},"14":{"loc":{"start":{"line":69,"column":12},"end":{"line":69,"column":51}},"type":"binary-expr","locations":[{"start":{"line":69,"column":12},"end":{"line":69,"column":30}},{"start":{"line":69,"column":34},"end":{"line":69,"column":51}}],"line":69}},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":8,"7":8,"8":8,"9":4,"10":8,"11":8,"12":1,"13":5,"14":5,"15":5,"16":5,"17":8,"18":8,"19":5,"20":5,"21":5,"22":8,"23":5,"24":1,"25":8,"26":8,"27":8,"28":8,"29":8,"30":1,"31":8,"32":4,"33":8,"34":8,"35":6,"36":2,"37":2,"38":2,"39":8,"40":5,"41":1},"f":{"0":1,"1":8,"2":4,"3":5,"4":8,"5":1},"b":{"0":[1,1,1],"1":[0,1],"2":[1,1],"3":[4,4],"4":[8,8],"5":[4,4],"6":[8,8],"7":[4,4],"8":[5,3],"9":[5,3],"10":[8,7],"11":[1,7],"12":[4,4],"13":[6,2],"14":[8,3]},"inputSourceMap":{"version":3,"file":"E:/GitHub-Demos/node-csv-excel/src/helpers/invoice.helper.ts","sources":["E:/GitHub-Demos/node-csv-excel/src/helpers/invoice.helper.ts"],"names":[],"mappings":"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","sourcesContent":["import JoiBase from \"joi\";\r\nconst Joi = JoiBase.extend(require('@joi/date'));\r\nimport { IInvoiceItemRaw, IInvoiceItemRawWithError, IProcessedInvoice, IProcessedInvoiceItem } from \"../types/invoice.type\";\r\n\r\nfunction validateInvoiceItem(invoiceItem: IInvoiceItemRaw) {\r\n    // Create Joi schema for validation\r\n    const joiSchema = Joi.object({\r\n        'Invoice Number': Joi.number().integer().required(),\r\n        'Date': Joi.date().format('M/D/YY'),\r\n        'Customer Name': Joi.string().trim().required(),\r\n        'Total Amount': Joi.number().required(),\r\n        'Item Description': Joi.string().trim().required(),\r\n        'Item Quantity': Joi.number().integer().required(),\r\n        'Item Price': Joi.number().required(),\r\n        'Item Total': Joi.number().required(),\r\n    });\r\n\r\n    // Validate invoice item against schema\r\n    const validateResult = joiSchema.validate(invoiceItem, { context: true, abortEarly: false });\r\n\r\n    // Fetch all error messages\r\n    const errorMessage = validateResult.error?.details?.map((errObj: { message: string }) => errObj.message).join('\\n');\r\n\r\n    // Generate and send response\r\n    const response = {\r\n        status: errorMessage ? 'error' : 'success',\r\n        data: validateResult.value,\r\n        message: errorMessage\r\n    };\r\n    return response;\r\n}\r\n\r\nexport const validateInvoiceItemsAndFormat = (invoiceItems: IInvoiceItemRaw[]) => {\r\n    let currentInvoiceNo: number;\r\n    let isDuplicateInvoice = false;\r\n\r\n    const processedInvoiceItems: IInvoiceItemRawWithError[] = [];\r\n    const processedInvoices: IProcessedInvoice[] = [];\r\n\r\n    invoiceItems.forEach(invoiceRow => {\r\n        let isInvoiceNoChanged = false;\r\n        if (invoiceRow[\"Invoice Number\"]) {\r\n            currentInvoiceNo = Number(invoiceRow[\"Invoice Number\"]);\r\n            isInvoiceNoChanged = true;\r\n            isDuplicateInvoice = false;\r\n        }\r\n\r\n        // Check unique invoice number\r\n        if (isInvoiceNoChanged) {\r\n            isDuplicateInvoice = processedInvoiceItems.some(invoiceItem => invoiceItem[\"Invoice Number\"] == currentInvoiceNo);\r\n        }\r\n\r\n        // Validate invoice item\r\n        const validationRes = validateInvoiceItem({ ...invoiceRow, \"Invoice Number\": currentInvoiceNo });\r\n        const normalizedObject = validationRes.data;\r\n\r\n        // Check if any error in item\r\n        const isParsingError = isDuplicateInvoice || validationRes.status === 'error';\r\n\r\n        // Generate error message\r\n        let parsingErrorMsg = '';\r\n\r\n        if (isDuplicateInvoice) parsingErrorMsg += 'Duplicate Invoice number.\\n';\r\n        if (validationRes.status === 'error') parsingErrorMsg += validationRes.message;\r\n\r\n        const invoiceItem: IProcessedInvoiceItem = {\r\n            itemDescription: normalizedObject[\"Item Description\"],\r\n            itemQuantity: normalizedObject[\"Item Quantity\"],\r\n            itemPrice: normalizedObject[\"Item Price\"],\r\n            itemTotal: normalizedObject[\"Item Total\"],\r\n            errorMessage: parsingErrorMsg\r\n        };\r\n\r\n        // Prepare Invoice wise JSON format\r\n        if (isInvoiceNoChanged || !currentInvoiceNo) {\r\n            processedInvoices.push({\r\n                invoiceNumber: currentInvoiceNo,\r\n                date: normalizedObject.Date,\r\n                customerName: normalizedObject[\"Customer Name\"],\r\n                totalAmount: normalizedObject[\"Total Amount\"],\r\n                isError: isParsingError,\r\n                items: [invoiceItem]\r\n            });\r\n        } else {\r\n            const currentInvoiceData = processedInvoices[processedInvoices.length - 1];\r\n            currentInvoiceData.isError = isParsingError;\r\n            currentInvoiceData.items.push(invoiceItem);\r\n        }\r\n\r\n        // Add error property.\r\n        processedInvoiceItems.push({\r\n            ...invoiceRow,\r\n            'Error(s)': parsingErrorMsg\r\n        });\r\n    });\r\n\r\n    // Return both: invoice items and error property and JSON formatted invoices\r\n    return {\r\n        processedInvoiceItems,\r\n        processedInvoices\r\n    };\r\n};\r\n"]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"7cc03b4e89b3d8e828d8fb74521103ad0741451d","contentHash":"feee252a4d9c02f8a0eb0a27a096bcafb88638873099bca8b6fe913cbccb09d7"}}